//
// Created by Artem on 01.01.2019.
//

#include <thread>
#include "utils.h"

ScopeLogger::ScopeLogger(const std::string &msg) : msg(msg) {
  std::cout << "[" << std::this_thread::get_id() << "]" << " Enter: " << msg << std::endl;
}
ScopeLogger::~ScopeLogger() { std::cout << "[" << std::this_thread::get_id() << "]" << " Exit:  " << msg << std::endl; }
int hl::utils::percent_decode(char *out, char *in) {
  static const char tbl[256] = {-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                                -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                                -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                                -1, -1, -1, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, -1, -1, -1, -1, -1, -1,
                                -1, 10, 11, 12, 13, 14, 15, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                                -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 10,
                                11, 12, 13, 14, 15, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                                -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                                -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                                -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                                -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                                -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                                -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                                -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                                -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
                                -1, -1, -1, -1, -1};
  char c, v1, v2;
  if (in != nullptr) {
    while ((c = *in++) != ' ') {
      switch (c) {
      case '%':
        if (!(v1 = *in++) || (v1 = tbl[(unsigned char) v1]) < 0
            || !(v2 = *in++)
            || (v2 = tbl[(unsigned char) v2]) < 0) {
          return -1;
        }
        c = (v1 << 4) | v2;
        break;
      case '+':c = ' ';
        break;
      default:break;
      }
      *out++ = c;
    }
  }
  *out = '\0';
  return 0;
}
